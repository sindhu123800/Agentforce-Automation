name: Deploy to QA Org

# -----------------------------
# üî• When should this workflow run?
# -----------------------------
on:
  push:
    branches:
      - main        # Runs automatically on push to main
  pull_request:
    branches:
      - main        # Runs on pull requests
  workflow_dispatch: # Allow manual run from GitHub UI
  # schedule:
  #   - cron: '0 3 * * *'  # Optional: auto-deploy daily at 3 AM

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:

      # -----------------------------
      # 1Ô∏è‚É£ Checkout the repo
      # -----------------------------
      - name: Checkout code
        uses: actions/checkout@v3

      # -----------------------------
      # 2Ô∏è‚É£ Install Salesforce CLI
      # -----------------------------
      - name: Install Salesforce CLI
        uses: sfdx-actions/setup-sfdx@v1

      # -----------------------------
      # 3Ô∏è‚É£ Authenticate using secret
      # -----------------------------
      - name: Authenticate to QA
        run: |
          mkdir -p auth
          echo "${{ secrets.SFDX_AUTH_URL_QA }}" > auth/qa.txt
          sfdx auth:sfdxurl:store -f auth/qa.txt -a QA
        shell: bash

      # -----------------------------
      # 4Ô∏è‚É£ Verify Login
      # -----------------------------
      - name: Verify authenticated org
        run: sfdx force:org:display -u QA

      # -----------------------------
      # 5Ô∏è‚É£ Deploy metadata
      # -----------------------------
      - name: Deploy metadata to QA
        run: |
          sfdx force:source:deploy -p force-app -u QA --verbose
